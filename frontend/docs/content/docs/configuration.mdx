---
title: Configuration
description: Complete configuration reference for Octopus API Gateway
---

import { Callout } from 'fumadocs-ui/components/callout';
import { Tabs } from 'fumadocs-ui/components/tabs';

# Configuration

Octopus is configured using YAML, TOML, or JSON files.

## Configuration File

Create a `config.yaml` file:

```yaml
server:
  http_port: 8080
  admin_port: 9090

discovery:
  backend: static

upstreams:
  - name: my-service
    instances:
      - address: localhost
        port: 8081

routes:
  - path: /api/*
    upstream: my-service
```

## Loading Configuration

```bash
# From file
octopus --config config.yaml

# From multiple files (merged)
octopus --config base.yaml --config overrides.yaml

# Validate without starting
octopus validate --config config.yaml
```

## Environment Variables

Use environment variables in configuration:

```yaml
server:
  http_port: ${HTTP_PORT:-8080}

auth:
  jwt_secret: ${JWT_SECRET}  # Required

database:
  url: ${DATABASE_URL}
```

Set variables before running:

```bash
export JWT_SECRET=your-secret
export DATABASE_URL=postgres://localhost/mydb
octopus --config config.yaml
```

## File Formats

<Tabs items={['YAML', 'TOML', 'JSON']}>

<div title="YAML">

```yaml
server:
  http_port: 8080
  admin_port: 9090

upstreams:
  - name: api-service
    instances:
      - address: localhost
        port: 8081
```

</div>

<div title="TOML">

```toml
[server]
http_port = 8080
admin_port = 9090

[[upstreams]]
name = "api-service"

[[upstreams.instances]]
address = "localhost"
port = 8081
```

</div>

<div title="JSON">

```json
{
  "server": {
    "http_port": 8080,
    "admin_port": 9090
  },
  "upstreams": [
    {
      "name": "api-service",
      "instances": [
        {
          "address": "localhost",
          "port": 8081
        }
      ]
    }
  ]
}
```

</div>

</Tabs>

## Configuration Sections

### Server

Configure the HTTP and admin servers:

```yaml
server:
  http_port: 8080
  https_port: 8443
  admin_port: 9090
  workers: auto
  read_timeout: 60s
  write_timeout: 60s
```

See [Server Configuration](/docs/configuration/server) for details.

### Discovery

Configure service discovery:

```yaml
discovery:
  backend: kubernetes
  kubernetes:
    namespace: default
    label_selector: "app=myapp"
```

See [Discovery Configuration](/docs/configuration/discovery) for details.

### Upstreams

Define backend services:

```yaml
upstreams:
  - name: user-service
    instances:
      - address: localhost
        port: 8081
    load_balance: round-robin
    health_check:
      type: http
      path: /health
```

See [Upstreams Configuration](/docs/configuration/upstreams) for details.

### Routes

Configure request routing:

```yaml
routes:
  - path: /api/users/*
    upstream: user-service
    methods: [GET, POST, PUT, DELETE]
    timeout: 30s
```

See [Routing Configuration](/docs/configuration/routing) for details.

### Middleware

Configure middleware:

```yaml
middleware:
  - auth
  - rate_limit
  - cors

auth:
  type: jwt
  secret: ${JWT_SECRET}

rate_limit:
  requests_per_second: 100
```

See [Middleware Configuration](/docs/configuration/middleware) for details.

### TLS

Configure TLS/HTTPS:

```yaml
tls:
  enabled: true
  cert: /etc/octopus/tls/cert.pem
  key: /etc/octopus/tls/key.pem
```

See [TLS Configuration](/docs/configuration/tls) for details.

### Observability

Configure metrics, tracing, and logging:

```yaml
observability:
  metrics:
    enabled: true
    path: /metrics
  tracing:
    enabled: true
    exporter: otlp
  logging:
    level: info
    format: json
```

See [Observability Configuration](/docs/configuration/observability) for details.

### Admin

Configure admin API:

```yaml
admin:
  enabled: true
  address: 0.0.0.0:9090
  auth:
    type: basic
    username: admin
    password_hash: $2b$...
```

See [Admin Configuration](/docs/configuration/admin) for details.

## Complete Example

```yaml
# Server configuration
server:
  http_port: 8080
  https_port: 8443
  admin_port: 9090
  workers: auto
  read_timeout: 60s
  write_timeout: 60s
  idle_timeout: 120s

# TLS configuration
tls:
  enabled: true
  cert: /etc/octopus/tls/cert.pem
  key: /etc/octopus/tls/key.pem
  min_version: "1.3"

# Service discovery
discovery:
  backend: kubernetes
  kubernetes:
    namespace: default
    label_selector: "app.kubernetes.io/part-of=myapp"

# FARP protocol
farp:
  enabled: true
  watch_interval: 5s
  schema_cache_ttl: 5m

# Upstreams
upstreams:
  - name: user-service
    instances:
      - address: user-service
        port: 8080
    health_check:
      type: http
      path: /health
      interval: 10s
    load_balance: round-robin
    
  - name: order-service
    instances:
      - address: order-service-1
        port: 8080
      - address: order-service-2
        port: 8080
    health_check:
      type: http
      path: /health
      interval: 10s
    load_balance: least-connections

# Routes
routes:
  - path: /api/users/*
    upstream: user-service
    methods: [GET, POST, PUT, DELETE]
    timeout: 30s
    retries: 3
    
  - path: /api/orders/*
    upstream: order-service
    methods: [GET, POST, PUT, DELETE]
    timeout: 30s
    circuit_breaker:
      enabled: true
      failure_threshold: 5

# Middleware
middleware:
  - auth
  - rate_limit
  - cors
  - compression

auth:
  type: jwt
  secret: ${JWT_SECRET}
  algorithm: HS256
  excluded_paths:
    - "/api/auth/login"
    - "/_/health"

rate_limit:
  strategy: token-bucket
  requests_per_second: 100
  burst: 200

cors:
  allowed_origins: ["*"]
  allowed_methods: [GET, POST, PUT, DELETE]
  allowed_headers: ["*"]

compression:
  enabled: true
  level: 6
  min_size: 1024

# Observability
observability:
  metrics:
    enabled: true
    path: /metrics
    port: 9090
  tracing:
    enabled: true
    exporter: otlp
    endpoint: http://jaeger:4317
  logging:
    level: info
    format: json

# Admin API
admin:
  enabled: true
  address: 0.0.0.0:9090
  auth:
    enabled: true
    type: basic
    username: admin
    password_hash: $2b$12$...
```

## Hot Reload

Reload configuration without restart:

```bash
# Send SIGHUP
kill -HUP <pid>

# Or via admin API
curl -X POST http://localhost:9090/_/reload
```

<Callout type="warn">
  Not all configuration can be hot-reloaded. Server ports and TLS settings require a restart.
</Callout>

## Validation

Validate configuration before deploying:

```bash
octopus validate --config config.yaml
```

Checks:
- Syntax errors
- Missing required fields
- Invalid values
- Upstream references
- Route conflicts

## Configuration Precedence

When using multiple configuration files:

1. Later files override earlier files
2. Environment variables override files
3. Command-line flags override all

```bash
octopus --config base.yaml \    # Base config
        --config prod.yaml \     # Production overrides
        --http-port 8081         # CLI override
```

## Best Practices

### 1. Use Environment Variables for Secrets

```yaml
auth:
  jwt_secret: ${JWT_SECRET}  # Never hardcode secrets
database:
  password: ${DB_PASSWORD}
```

### 2. Split Configuration

```yaml
# base.yaml - Common config
server:
  http_port: 8080

# dev.yaml - Development overrides
observability:
  logging:
    level: debug

# prod.yaml - Production overrides
observability:
  logging:
    level: info
```

### 3. Use Defaults

```yaml
server:
  http_port: ${HTTP_PORT:-8080}  # Default to 8080
  workers: ${WORKERS:-auto}       # Default to auto
```

### 4. Document Configuration

Add comments to explain non-obvious settings:

```yaml
server:
  # Increase for high-traffic scenarios
  workers: 16
  
  # Long timeout for file uploads
  read_timeout: 300s
```

## Next Steps

Dive into specific configuration topics:

- [Server Configuration](/docs/configuration/server)
- [Discovery Configuration](/docs/configuration/discovery)
- [Upstreams Configuration](/docs/configuration/upstreams)
- [Routing Configuration](/docs/configuration/routing)
- [Middleware Configuration](/docs/configuration/middleware)
- [TLS Configuration](/docs/configuration/tls)
- [Observability Configuration](/docs/configuration/observability)
- [Admin Configuration](/docs/configuration/admin)
